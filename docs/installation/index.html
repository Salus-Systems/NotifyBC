<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Installation | NotifyBC</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" type="image/x-icon" href="/NotifyBC/favicon.ico">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <meta name="description" content="A versatile notification API server">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/NotifyBC/assets/css/0.styles.9c098ad7.css" as="style"><link rel="preload" href="/NotifyBC/assets/js/app.b6fd4c09.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/4.020a5358.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/5.3d40ef60.js" as="script"><link rel="preload" href="/NotifyBC/assets/js/39.8cb0fbc0.js" as="script"><link rel="prefetch" href="/NotifyBC/assets/js/1.bc6d0c34.js"><link rel="prefetch" href="/NotifyBC/assets/js/10.bf7132ba.js"><link rel="prefetch" href="/NotifyBC/assets/js/11.298946b3.js"><link rel="prefetch" href="/NotifyBC/assets/js/12.50a9a233.js"><link rel="prefetch" href="/NotifyBC/assets/js/13.b2e71baf.js"><link rel="prefetch" href="/NotifyBC/assets/js/14.5ee52727.js"><link rel="prefetch" href="/NotifyBC/assets/js/15.94cb0e70.js"><link rel="prefetch" href="/NotifyBC/assets/js/16.fc871483.js"><link rel="prefetch" href="/NotifyBC/assets/js/17.f88b6a89.js"><link rel="prefetch" href="/NotifyBC/assets/js/18.fef9eb8e.js"><link rel="prefetch" href="/NotifyBC/assets/js/19.b83e7cff.js"><link rel="prefetch" href="/NotifyBC/assets/js/20.def36d54.js"><link rel="prefetch" href="/NotifyBC/assets/js/21.e2de935c.js"><link rel="prefetch" href="/NotifyBC/assets/js/22.2bdba0b4.js"><link rel="prefetch" href="/NotifyBC/assets/js/23.f216daba.js"><link rel="prefetch" href="/NotifyBC/assets/js/24.400c722f.js"><link rel="prefetch" href="/NotifyBC/assets/js/25.39538b48.js"><link rel="prefetch" href="/NotifyBC/assets/js/26.5a0fa715.js"><link rel="prefetch" href="/NotifyBC/assets/js/27.026c9772.js"><link rel="prefetch" href="/NotifyBC/assets/js/28.e7d3b656.js"><link rel="prefetch" href="/NotifyBC/assets/js/29.d6454e0e.js"><link rel="prefetch" href="/NotifyBC/assets/js/30.bd904d93.js"><link rel="prefetch" href="/NotifyBC/assets/js/31.eb30c15f.js"><link rel="prefetch" href="/NotifyBC/assets/js/32.e489d957.js"><link rel="prefetch" href="/NotifyBC/assets/js/33.b89ac211.js"><link rel="prefetch" href="/NotifyBC/assets/js/34.e7e456a2.js"><link rel="prefetch" href="/NotifyBC/assets/js/35.360832fb.js"><link rel="prefetch" href="/NotifyBC/assets/js/36.da8c6578.js"><link rel="prefetch" href="/NotifyBC/assets/js/37.aa68c0aa.js"><link rel="prefetch" href="/NotifyBC/assets/js/38.4705e794.js"><link rel="prefetch" href="/NotifyBC/assets/js/40.ca19cc4b.js"><link rel="prefetch" href="/NotifyBC/assets/js/41.acb80f16.js"><link rel="prefetch" href="/NotifyBC/assets/js/42.cf83461e.js"><link rel="prefetch" href="/NotifyBC/assets/js/43.37973854.js"><link rel="prefetch" href="/NotifyBC/assets/js/44.6b68297f.js"><link rel="prefetch" href="/NotifyBC/assets/js/45.93f33b75.js"><link rel="prefetch" href="/NotifyBC/assets/js/46.98a51446.js"><link rel="prefetch" href="/NotifyBC/assets/js/47.6f3cd5aa.js"><link rel="prefetch" href="/NotifyBC/assets/js/48.7af7defd.js"><link rel="prefetch" href="/NotifyBC/assets/js/49.b1ce24f8.js"><link rel="prefetch" href="/NotifyBC/assets/js/50.3f7ffc44.js"><link rel="prefetch" href="/NotifyBC/assets/js/6.89fa43a9.js"><link rel="prefetch" href="/NotifyBC/assets/js/7.99ce724d.js"><link rel="prefetch" href="/NotifyBC/assets/js/8.3a6a523a.js"><link rel="prefetch" href="/NotifyBC/assets/js/9.ea1e0ef2.js"><link rel="prefetch" href="/NotifyBC/assets/js/vendors~docsearch.55fbae7d.js">
    <link rel="stylesheet" href="/NotifyBC/assets/css/0.styles.9c098ad7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/NotifyBC/" class="home-link router-link-active"><img src="/NotifyBC/img/logo.svg" alt="NotifyBC" class="logo"></a> <!----> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/NotifyBC/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/bcgov/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/NotifyBC/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/bcgov/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/" aria-current="page" class="sidebar-link">Welcome</a></li><li><a href="/NotifyBC/docs/overview/" class="sidebar-link">Overview</a></li><li><a href="/NotifyBC/docs/quickstart/" class="sidebar-link">Quick Start</a></li><li><a href="/NotifyBC/docs/installation/" aria-current="page" class="active sidebar-link">Installation</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotifyBC/docs/installation/#deploy-locally-from-source-code" class="sidebar-link">Deploy Locally from Source Code</a></li><li class="sidebar-sub-header"><a href="/NotifyBC/docs/installation/#deploy-docker-container" class="sidebar-link">Deploy Docker Container</a></li><li class="sidebar-sub-header"><a href="/NotifyBC/docs/installation/#deploy-to-kubernetes" class="sidebar-link">Deploy to Kubernetes</a></li></ul></li><li><a href="/NotifyBC/docs/web-console/" class="sidebar-link">Web Console</a></li><li><a href="/NotifyBC/docs/what's-new/" class="sidebar-link">What's New</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Configuration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/config-overview/" class="sidebar-link">Configuration Overview</a></li><li><a href="/NotifyBC/docs/config-database/" class="sidebar-link">Database</a></li><li><a href="/NotifyBC/docs/config-adminIpList/" class="sidebar-link">Admin IP List</a></li><li><a href="/NotifyBC/docs/config-reverseProxyIpLists/" class="sidebar-link">Reverse Proxy IP Lists</a></li><li><a href="/NotifyBC/docs/config-httpHost/" class="sidebar-link">HTTP Host</a></li><li><a href="/NotifyBC/docs/config-internalHttpHost/" class="sidebar-link">Internal HTTP Host</a></li><li><a href="/NotifyBC/docs/config-smtp/" class="sidebar-link">SMTP</a></li><li><a href="/NotifyBC/docs/config-sms/" class="sidebar-link">SMS</a></li><li><a href="/NotifyBC/docs/config-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/docs/config-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/docs/config-nodeRoles/" class="sidebar-link">Node Roles</a></li><li><a href="/NotifyBC/docs/config-cronJobs/" class="sidebar-link">Cron Jobs</a></li><li><a href="/NotifyBC/docs/config-rsaKeys/" class="sidebar-link">RSA Keys</a></li><li><a href="/NotifyBC/docs/config-inboundSmtpServer/" class="sidebar-link">Inbound SMTP Server</a></li><li><a href="/NotifyBC/docs/config-listUnsubscribeByEmail/" class="sidebar-link">List-unsubscribe by Email</a></li><li><a href="/NotifyBC/docs/config-notificationBounce/" class="sidebar-link">Notification Bounce</a></li><li><a href="/NotifyBC/docs/config-workerProcessCount/" class="sidebar-link">Worker Process Count</a></li><li><a href="/NotifyBC/docs/config-middleware/" class="sidebar-link">Middleware</a></li><li><a href="/NotifyBC/docs/config-oidc/" class="sidebar-link">OIDC</a></li><li><a href="/NotifyBC/docs/config-certificates/" class="sidebar-link">TLS Certificates</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/api-overview/" class="sidebar-link">API Overview</a></li><li><a href="/NotifyBC/docs/api-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/docs/api-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/docs/api-config/" class="sidebar-link">Configuration</a></li><li><a href="/NotifyBC/docs/api-administrator/" class="sidebar-link">Administrator</a></li><li><a href="/NotifyBC/docs/api-bounce/" class="sidebar-link">Bounce</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/benchmarks/" class="sidebar-link">Benchmarks</a></li><li><a href="/NotifyBC/docs/bulk-import/" class="sidebar-link">Bulk Import</a></li><li><a href="/NotifyBC/docs/developer-notes/" class="sidebar-link">Developer Notes</a></li><li><a href="/NotifyBC/docs/upgrade/" class="sidebar-link">Upgrade Guide</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Meta</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/docs/conduct/" class="sidebar-link">Code of Conduct</a></li><li><a href="/NotifyBC/docs/acknowledgments/" class="sidebar-link">Acknowledgments</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h1> <p><em>NotifyBC</em> can be installed in 3 ways:</p> <ol><li><a href="#deploy-locally-from-source-code">Deploy Locally from Source Code</a></li> <li><a href="#deploy-docker-container">Deploy Docker Container</a></li> <li><a href="#deploy-to-kubernetes">Deploy to Kubernetes</a></li></ol> <p>For small-scale production deployment or for evaluation, both source code and docker container will do. For large-scale production deployment that requires horizontal scalability, the recommendation is one of</p> <ul><li>deploying to Kubernetes</li> <li>setting up a load balanced app cluster from source code build, backed by MongoDB.</li></ul> <p>To setup a development environment in order to contribute to <em>NotifyBC</em>,
installing from source code is preferred.</p> <h2 id="deploy-locally-from-source-code"><a href="#deploy-locally-from-source-code" class="header-anchor">#</a> Deploy Locally from Source Code</h2> <h3 id="system-requirements"><a href="#system-requirements" class="header-anchor">#</a> System Requirements</h3> <ul><li>Software
<ul><li>Git</li> <li><a href="https://nodejs.org" target="_blank" rel="noopener noreferrer">Node.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>@&gt;=14.5.0</li> <li>openssl (if enable HTTPS)</li></ul></li> <li>Services
<ul><li>MongoDB, optional but recommended for production</li> <li>A standard SMTP server to deliver outgoing email, optional but recommended for production.</li> <li>A tcp proxy server such as <a href="http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html" target="_blank" rel="noopener noreferrer">nginx stream proxy<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> if list-unsubscribe by email is needed and <em>NotifyBC</em> server cannot expose port 25 to internet</li> <li>A SMS service provider account if needs to enable SMS channel. The supported service providers are
<ul><li>Twilio (default)</li> <li>Swift</li></ul></li> <li>SiteMinder, if need to allow SiteMinder authenticated user request</li> <li>OIDC provide, if need to allow OIDC authenticated user request</li></ul></li> <li>Network and Permissions
<ul><li>Minimum runtime firewall requirements:
<ul><li>outbound to your ISP DNS server</li> <li>outbound to any on port 80 and 443 in order to run build scripts and send SMS messages</li> <li>outbound to any on SMTP port 25 if using direct mail; for SMTP relay, outbound to your configured SMTP server and port only</li> <li>inbound to listening port (3000 by default) from other authorized server ips</li> <li>if <em>NotifyBC</em> instance will handle anonymous subscription from client browser, the listening port should be open to internet either directly or indirectly through a reverse proxy; If <em>NotifyBC</em> instance will only handle SiteMinder authenticated webapp requests, the listening port should NOT be open to internet. Instead, it should only open to SiteMinder web agent reverse proxy.</li></ul></li> <li>If list-unsubscribe by email is needed, then one of the following must be met
<ul><li><em>NotifyBC</em> can bind to port 25 opening to internet</li> <li>a tcp proxy server of which port 25 is open to internet. This proxy server can reach <em>NotifyBC</em> on a tcp port.</li></ul></li></ul></li></ul> <h3 id="installation-2"><a href="#installation-2" class="header-anchor">#</a> Installation</h3> <p>Run following commands</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">git</span> clone https://github.com/bcgov/NotifyBC.git
<span class="token builtin class-name">cd</span> NotifyBC
<span class="token function">npm</span> i -g <span class="token function">yarn</span> <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> <span class="token function">install</span> <span class="token operator">&amp;&amp;</span> <span class="token function">yarn</span> build
<span class="token function">yarn</span> start
</code></pre></div><p>If successful, you will see following output</p> <div class="language- extra-class"><pre class="language-text"><code>...
Server is running at http://0.0.0.0:3000
</code></pre></div><p>Now browse to <a href="http://localhost:3000" target="_blank">http://localhost:3000</a> the page displays NotifyBC Web Console.</p> <p>The above commands installs the <em>main</em> version, i.e. main branch tip of <em>NotifyBC</em> GitHub repository. To install a specific version, say <em>v2.1.0</em>, run</p> <div class="language-sh extra-class"><pre class="language-sh"><code> <span class="token function">git</span> checkout tags/v2.1.0 -b v2.1.0
</code></pre></div><p>after <code>cd NotifyBC</code>. A list of versions can be found <a href="https://github.com/bcgov/NotifyBC/tags" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <div class="custom-block tip"><p class="custom-block-title">install from behind firewall</p> <p>If you want to install on a server behind firewall which restricts internet connection, you can work around the firewall as long as you have access to a http(s) forward proxy server. Assuming the proxy server is http://my_proxy:8080 which proxies both http and https requests, to use it:</p> <ul><li><p>For Linux</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token builtin class-name">export</span> <span class="token assign-left variable">http_proxy</span><span class="token operator">=</span>http://my_proxy:8080
<span class="token builtin class-name">export</span> <span class="token assign-left variable">https_proxy</span><span class="token operator">=</span>http://my_proxy:8080
<span class="token function">git</span> config --global url.<span class="token string">&quot;https://&quot;</span>.insteadOf git://
</code></pre></div></li> <li><p>For Windows</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">git</span> config --global http.proxy http://my_proxy:8080
<span class="token function">git</span> config --global url.<span class="token string">&quot;https://&quot;</span>.insteadOf git://
<span class="token function">npm</span> config <span class="token builtin class-name">set</span> proxy http://my_proxy:8080
<span class="token function">npm</span> i -g <span class="token function">yarn</span>
<span class="token function">yarn</span> config <span class="token builtin class-name">set</span> proxy http://my_proxy:8080
</code></pre></div></li></ul></div> <h4 id="install-windows-service"><a href="#install-windows-service" class="header-anchor">#</a> Install Windows Service</h4> <p>After get the app running interactively, if your server is Windows and you want to install the app as a Windows service, run</p> <div class="language- extra-class"><pre class="language-text"><code>npm install -g node-windows
npm link node-windows
node windows-service.js
</code></pre></div><p>This will create and start service <em>notifyBC</em>. To change service name, modify file <em>windows-service.js</em> before running it. See <a href="https://github.com/coreybutler/node-windows" target="_blank" rel="noopener noreferrer">node-windows<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for other operations such as uninstalling the service.</p> <h2 id="deploy-docker-container"><a href="#deploy-docker-container" class="header-anchor">#</a> Deploy Docker Container</h2> <p>If you have git and Docker installed, you can run following command to deploy <em>NotifyBC</em> Docker container:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">git</span> clone https://github.com/bcgov/NotifyBC.git
<span class="token builtin class-name">cd</span> NotifyBC
docker build -t notify-bc <span class="token builtin class-name">.</span>
docker run -p <span class="token number">3000</span>:3000 notify-bc
</code></pre></div><p>If successful, similar output is displayed as in source code installation.</p> <h2 id="deploy-to-kubernetes"><a href="#deploy-to-kubernetes" class="header-anchor">#</a> Deploy to Kubernetes</h2> <p><em>NotifyBC</em> provides a <a href="https://github.com/orgs/bcgov/packages/container/package/notify-bc" target="_blank" rel="noopener noreferrer">container package<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> in GitHub Container Registry and a <a href="https://helm.sh/" target="_blank" rel="noopener noreferrer">Helm<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> chart to facilitate Deploying to Kubernetes. Azure AKS and OpenShift are the two tested platforms. Other Kubernetes platforms are likely to work subject to customizations. Before deploying to AKS, <a href="https://docs.microsoft.com/en-us/azure/aks/ingress-basic#create-an-ingress-controller" target="_blank" rel="noopener noreferrer">create an ingress controller
<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>The deployment can be initiated from localhost or automated by CI service such as Jenkins. Regardless, at the initiator's side following software needs to be installed:</p> <ul><li>git</li> <li>Platform-specific CLI such as <a href="https://docs.microsoft.com/en-us/cli/azure/" target="_blank" rel="noopener noreferrer">Azure CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://docs.openshift.org/latest/cli_reference/index.html" target="_blank" rel="noopener noreferrer">OpenShift CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener noreferrer">Helm CLI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <p>To install,</p> <ol><li><p>Follow your platform's instruction to login to the platform. For AKS, run <code>az login</code> and <code>az aks get-credentials</code>; for OpenShift, run <code>oc login</code></p></li> <li><p>Run</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token function">git</span> clone https://github.com/bcgov/NotifyBC.git
<span class="token builtin class-name">cd</span> NotifyBC
helm <span class="token function">install</span> -gf helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml helm
</code></pre></div><p>replace &lt;platform&gt; with <em>openshift</em> or <em>aks</em> depending on your platform.</p> <p>The above commands create following artifacts:</p> <ul><li>A MongoDB cluster with 2 nodes and 1 arbiter, each implemented as a stateful set</li> <li>Two deployments - <em>notify-bc-app</em> and <em>notify-bc-cron</em></li> <li>One HPA - <em>notify-bc-cron</em></li> <li>Four services - <em>notify-bc</em>, <em>notify-bc-smtp</em>, <em>mongodb-headless</em> and <em>mongodb-arbiter-headless</em></li> <li>Two PVCs each for one MongoDB node</li> <li>Two config maps - <em>notify-bc</em> and <em>mongodb-scripts</em></li> <li>Two service accounts - <em>notify-bc</em> and <em>mongodb</em></li> <li>One more more secrets, with the most important one being <em>mongodb</em>, containing MongoDB connection credentials</li> <li>On AKS,
<ul><li>a <em>notify-bc</em> ingress</li></ul></li> <li>On OpenShift,
<ul><li>2 routes - <em>notify-bc-web</em> and <em>notify-bc-smtp</em></li></ul></li></ul></li></ol> <p>To upgrade,</p> <div class="language-sh extra-class"><pre class="language-sh"><code>helm upgrade <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span> -f helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml --set mongodb.auth.rootPassword<span class="token operator">=</span><span class="token operator">&lt;</span>mongodb-root-password<span class="token operator">&gt;</span> --set mongodb.auth.replicaSetKey<span class="token operator">=</span><span class="token operator">&lt;</span>mongodb-replica-set-key<span class="token operator">&gt;</span> --set mongodb.auth.password<span class="token operator">=</span><span class="token operator">&lt;</span>mongodb-password<span class="token operator">&gt;</span> helm
</code></pre></div><p>replace &lt;release-name&gt; with installed helm release name and &lt;platform&gt; with <em>openshift</em> or <em>aks</em> depending on your platform. &lt;mongodb-root-password&gt;, &lt;mongodb-replica-set-key&gt; and &lt;mongodb-password&gt; can be found in <em>mongodb</em> secret.</p> <p>To uninstall,</p> <div class="language-sh extra-class"><pre class="language-sh"><code>helm uninstall <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span>
</code></pre></div><p>replace &lt;release-name&gt; with installed helm release name.</p> <h3 id="customizations"><a href="#customizations" class="header-anchor">#</a> Customizations</h3> <p>Various customizations can be made to chart. Some are platform dependent. To customize, first create a file with extension <em>.local.yaml</em>. The rest of the document assumes the file is <em>helm/values.local.yaml</em>. Then add customized parameters to the file. See <em>helm/values.yaml</em> and Bitnami MongoDB chart <a href="https://github.com/bitnami/charts/tree/master/bitnami/mongodb" target="_blank" rel="noopener noreferrer">readme<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for customizable parameters. Parameters in <em>helm/values.local.yaml</em> overrides corresponding ones in <em>helm/values.yaml</em>. In particular, parameters under <em>mongodb</em> of <em>helm/values.local.yaml</em> overrides Bitnami MongoDB chart parameters.</p> <p>To apply customizations, add <code>-f helm/values.local.yaml</code> to the helm command after <code>-f helm/platform-specific/&lt;platform&gt;.yaml</code>. For example, to run <code>helm install</code> with customization,</p> <div class="language-sh extra-class"><pre class="language-sh"><code>helm <span class="token function">install</span> -gf helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml -f helm/values.local.yaml helm
</code></pre></div><p>to run <code>helm upgrade</code> with customization,</p> <div class="language-sh extra-class"><pre class="language-sh"><code>helm upgrade <span class="token operator">&lt;</span>release-name<span class="token operator">&gt;</span> -f helm/platform-specific/<span class="token operator">&lt;</span>platform<span class="token operator">&gt;</span>.yaml -f helm/values.local.yaml helm
</code></pre></div><div class="custom-block tip"><p class="custom-block-title">Backup <i>helm/values.local.yaml</i></p> <p>Backup <em>helm/values.local.yaml</em> to a private secured SCM is highly recommended, especially for production environment.</p></div> <p>Following are some example customizations.</p> <ul><li><p>To set hostname on AKS,</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> myNotifyBC.myOrg.com
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">path</span><span class="token punctuation">:</span> /
</code></pre></div></li> <li><p>Use <a href="https://docs.microsoft.com/en-us/azure/aks/ingress-tls" target="_blank" rel="noopener noreferrer">Let's Encrypt on AKS<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. After following the instructions in the link, add following ingress customizations to file <em>helm/values.local.yaml</em></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">ingress</span><span class="token punctuation">:</span>
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">cert-manager.io/cluster-issuer</span><span class="token punctuation">:</span> letsencrypt
  <span class="token key atrule">tls</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">secretName</span><span class="token punctuation">:</span> tls<span class="token punctuation">-</span>secret
      <span class="token key atrule">hosts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> notify<span class="token punctuation">-</span>bc.local
</code></pre></div></li> <li><p>Route host names on Openshift are by default auto-generated. To set to fix values</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">route</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">'myNotifyBC.myOrg.com'</span>
  <span class="token key atrule">smtp</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> <span class="token string">'smtp.myNotifyBC.myOrg.com'</span>
</code></pre></div></li> <li><p>To add certificates to OpenShift web route</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">route</span><span class="token punctuation">:</span>
  <span class="token key atrule">web</span><span class="token punctuation">:</span>
    <span class="token key atrule">tls</span><span class="token punctuation">:</span>
      <span class="token key atrule">caCertificate</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
        <span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>BEGIN CERTIFICATE<span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>
        <span class="token punctuation">...</span>
        <span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>END CERTIFICATE<span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>
      <span class="token key atrule">certificate</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
        <span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>BEGIN CERTIFICATE<span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>
        <span class="token punctuation">...</span>
        <span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>END CERTIFICATE<span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>
      <span class="token key atrule">insecureEdgeTerminationPolicy</span><span class="token punctuation">:</span> Redirect
      <span class="token key atrule">key</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
        <span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>BEGIN PRIVATE KEY<span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>
        <span class="token punctuation">...</span>
        <span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>END PRIVATE KEY<span class="token punctuation">---</span><span class="token punctuation">-</span><span class="token punctuation">-</span>
</code></pre></div></li> <li><p>To update <em>config.local.js</em> in config map,</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">configMap</span><span class="token punctuation">:</span>
  <span class="token key atrule">config.local.js</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token punctuation">-</span>
    module.exports = <span class="token punctuation">{</span>
      <span class="token key atrule">httpHost</span><span class="token punctuation">:</span> <span class="token string">'https://myNotifyBC.myOrg.com'</span><span class="token punctuation">,</span>
      <span class="token key atrule">internalHttpHost</span><span class="token punctuation">:</span> <span class="token string">'http://{{include &quot;NotifyBC.fullname&quot; .}}:{{ .Values.service.web.port }}'</span><span class="token punctuation">,</span>
      <span class="token key atrule">inboundSmtpServer</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token key atrule">listeningSmtpPort</span><span class="token punctuation">:</span> <span class="token number">2525</span><span class="token punctuation">,</span>
        <span class="token key atrule">options</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> if not (.Values.service.smtp.enabled) <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">secure</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
          <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">-</span> end <span class="token punctuation">}</span><span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre></div></li> <li><p>MongoDb</p> <p><em>NotifyBC</em> chart depends on <a href="https://github.com/bitnami/charts/tree/master/bitnami/mongodb" target="_blank" rel="noopener noreferrer">Bitnami MongoDB chart<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> for MongoDB database provisioning. All documented parameters are customizable by adding <em>mongodb.</em> prefix. For example, to change <em>architecture</em> to <em>standalone</em></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
  <span class="token key atrule">architecture</span><span class="token punctuation">:</span> standalone
</code></pre></div><p>Bitnami MongoDB uses Docker Hub for docker registry. Rate limit imposed by Docker Hub can cause runtime problems. If your organization has JFrog artifactory, you can change the registry</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">mongodb</span><span class="token punctuation">:</span>
  <span class="token key atrule">image</span><span class="token punctuation">:</span>
    <span class="token key atrule">registry</span><span class="token punctuation">:</span> &lt;artifactory.myOrg.com<span class="token punctuation">&gt;</span>
    <span class="token key atrule">pullSecrets</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> &lt;docker<span class="token punctuation">-</span>pull<span class="token punctuation">-</span>secret<span class="token punctuation">&gt;</span>
</code></pre></div><p>The above settings assume you have setup secret &lt;docker-pull-secret&gt; to access &lt;artifactory.myOrg.com&gt;.</p></li> <li><p>Enable scheduled MongoDB backup CronJob</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">cronJob</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">schedule</span><span class="token punctuation">:</span> <span class="token string">'1 0 * * *'</span>
  <span class="token key atrule">retentionDays</span><span class="token punctuation">:</span> <span class="token number">7</span>
  <span class="token key atrule">timeZone</span><span class="token punctuation">:</span> UTC
  <span class="token key atrule">persistence</span><span class="token punctuation">:</span>
    <span class="token key atrule">size</span><span class="token punctuation">:</span> 5Gi
</code></pre></div><p>where</p> <ul><li>enabled: whether to enable the MongoDB backup CronJob or not; default to <code>false</code></li> <li>schedule: the Unix crontab schedule; default to <code>'1 0 * * *'</code> which runs daily at 12:01AM</li> <li>retentionDays: how many days the backup is retained; default to <code>7</code></li> <li>timeZone: the Unix TZ environment variable; default to <code>UTC</code></li> <li>persistence size: size of PVC; default to <code>5Gi</code></li></ul> <p>The CronJob backs up MongoDB to a PVC named after the chart with suffix <em>-cronjob-mongodb-backup</em> and purges backups that are older than <em>retentionDays</em>.</p></li> <li><p><em>NotifyBC</em> image tag defaults to latest published version. To change to <em>latest</em>, i.e. tip of the <em>main branch</em>,</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">image</span><span class="token punctuation">:</span>
  <span class="token key atrule">tag</span><span class="token punctuation">:</span> latest
</code></pre></div></li> <li><p>Enable autoscaling for app pod</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># in file helm/values.local.yaml</span>
<span class="token key atrule">autoscaling</span><span class="token punctuation">:</span>
  <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NotifyBC/docs/quickstart/" class="prev">
        Quick Start
      </a></span> <span class="next"><a href="/NotifyBC/docs/web-console/">
        Web Console
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/NotifyBC/assets/js/app.b6fd4c09.js" defer></script><script src="/NotifyBC/assets/js/4.020a5358.js" defer></script><script src="/NotifyBC/assets/js/5.3d40ef60.js" defer></script><script src="/NotifyBC/assets/js/39.8cb0fbc0.js" defer></script>
  </body>
</html>

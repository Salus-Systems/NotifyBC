#!/bin/bash
# make sure copy and mv applies to dot files
shopt -s dotglob nullglob
# fail fast
set -e
# restore build artifacts
if [ "$(ls /tmp/artifacts/ 2>/dev/null)" ]; then
    echo "---> restore build artifacts"
    mv /tmp/artifacts/* ./
fi
echo "---> Installing application source"
rm -rf /tmp/src/node_modules /tmp/src/docs /tmp/src/utils
mv /tmp/src/.s2i/configs/datasources.production.js /tmp/src/server/
mv /tmp/src/.s2i/configs/config.production.json /tmp/src/server/
chmod -R a+rwx /tmp/src
mv -f /tmp/src/* ./
echo "---> Building your Node application from source"
npm install
echo "---> Run unit tests"
npm test

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Inbound SMTP Server | NotifyBC</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" type="image/x-icon" href="/NotifyBC/version/2-pre-alpha/favicon.ico">
    <meta name="description" content="A versatile notification API server">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/NotifyBC/version/2-pre-alpha/assets/css/0.styles.34505621.css" as="style"><link rel="preload" href="/NotifyBC/version/2-pre-alpha/assets/js/app.aa1ca42f.js" as="script"><link rel="preload" href="/NotifyBC/version/2-pre-alpha/assets/js/4.ef7266ed.js" as="script"><link rel="preload" href="/NotifyBC/version/2-pre-alpha/assets/js/5.c02a3e01.js" as="script"><link rel="preload" href="/NotifyBC/version/2-pre-alpha/assets/js/21.c7ec8954.js" as="script"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/1.bd48a1db.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/10.2bef35fd.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/11.4bbd994b.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/12.7f56b1ed.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/13.288679e1.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/14.bce72d75.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/15.60f03866.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/16.70116f69.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/17.e411f562.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/18.b41f3da7.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/19.321b833f.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/20.71b61f7e.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/22.d13a62e2.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/23.95642fe5.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/24.055c9570.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/25.4595ff74.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/26.aa980f89.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/27.985b5b78.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/28.a665c3e9.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/29.c42d69bf.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/30.d1a04973.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/31.eeb26368.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/32.9b139893.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/33.ae9c94a6.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/34.3e34c15e.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/35.e934d5e7.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/36.e12e0214.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/37.09514c06.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/38.3f3a39f3.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/39.0e227568.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/40.9e427c7b.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/41.463d0cde.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/42.a104efbd.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/43.bee8ff6c.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/44.c9a728a0.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/45.ff07e7e1.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/6.46c3f8c1.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/7.fad6e7a1.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/8.80e335db.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/9.d6c0ab18.js"><link rel="prefetch" href="/NotifyBC/version/2-pre-alpha/assets/js/vendors~docsearch.7c8df9eb.js">
    <link rel="stylesheet" href="/NotifyBC/version/2-pre-alpha/assets/css/0.styles.34505621.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/NotifyBC/version/2-pre-alpha/" class="home-link router-link-active"><img src="/NotifyBC/version/2-pre-alpha/img/logo.svg" alt="NotifyBC" class="logo"></a> <!----> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/NotifyBC/version/2-pre-alpha/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/version/2-pre-alpha/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/version/2-pre-alpha/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/bcgov/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/NotifyBC/version/2-pre-alpha/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/NotifyBC/version/2-pre-alpha/docs/" class="nav-link router-link-active">
  Docs
</a></div><div class="nav-item"><a href="/NotifyBC/version/2-pre-alpha/help/" class="nav-link">
  Help
</a></div> <a href="https://github.com/bcgov/NotifyBC" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/version/2-pre-alpha/docs/" aria-current="page" class="sidebar-link">Welcome</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/overview/" class="sidebar-link">Overview</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/quickstart/" class="sidebar-link">Quick Start</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/installation/" class="sidebar-link">Installation</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/usage/" class="sidebar-link">Basic Usage</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Configuration</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-overview/" class="sidebar-link">Configuration Overview</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-adminIpList/" class="sidebar-link">Admin IP List</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-reverseProxyIpLists/" class="sidebar-link">Reverse Proxy IP Lists</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-httpHost/" class="sidebar-link">HTTP Host</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-smtp/" class="sidebar-link">SMTP</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-sms/" class="sidebar-link">SMS</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-database/" class="sidebar-link">Database</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-nodeRoles/" class="sidebar-link">Node Roles</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-cronJobs/" class="sidebar-link">Cron Jobs</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-rsaKeys/" class="sidebar-link">RSA Keys</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-internalHttpHost/" class="sidebar-link">Internal HTTP Host</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-inboundSmtpServer/" aria-current="page" class="active sidebar-link">Inbound SMTP Server</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/NotifyBC/version/2-pre-alpha/docs/config-inboundSmtpServer/#tcp-proxy-server" class="sidebar-link">TCP Proxy Server</a></li></ul></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-listUnsubscribeByEmail/" class="sidebar-link">List-unsubscribe by Email</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-notificationBounce/" class="sidebar-link">Notification Bounce</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-workerProcessCount/" class="sidebar-link">Worker Process Count</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>API</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/version/2-pre-alpha/docs/api-overview/" class="sidebar-link">API Overview</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/api-subscription/" class="sidebar-link">Subscription</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/api-notification/" class="sidebar-link">Notification</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/api-config/" class="sidebar-link">Configuration</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/api-administrator/" class="sidebar-link">Administrator</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/api-bounce/" class="sidebar-link">Bounce</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Miscellaneous</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/version/2-pre-alpha/docs/benchmarks/" class="sidebar-link">Benchmarks</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/bulk-import/" class="sidebar-link">Bulk Import</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/developer-notes/" class="sidebar-link">Developer Notes</a></li><li><a href="/NotifyBC/version/2-pre-alpha/docs/miscellaneous/migration.html" class="sidebar-link">Migration Guide</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Meta</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/NotifyBC/version/2-pre-alpha/docs/conduct/" class="sidebar-link">Code of Conduct</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="inbound-smtp-server"><a href="#inbound-smtp-server" class="header-anchor">#</a> Inbound SMTP Server</h1> <p><em>NotifyBC</em> implemented a custom inbound SMTP server based on Nodemailer <a href="https://nodemailer.com/extras/smtp-server/" target="_blank" rel="noopener noreferrer">SMTP Server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to handle</p> <ul><li><a href="/NotifyBC/version/2-pre-alpha/docs/config-listUnsubscribeByEmail/">list-unsubscribe by email</a></li> <li><a href="/NotifyBC/version/2-pre-alpha/docs/config-notificationBounce/">notification bounce</a></li></ul> <p>In order for the emails from internet to reach the SMTP server, a host
where one of the following servers should be listening on port 25
open to internet</p> <ol><li><em>NotifyBC</em>, if it can be installed on such internet-facing host directly; otherwise,</li> <li>a tcp proxy server, such as nginx with stream proxy module that can proxy tcp port 25 traffic to backend <em>NotifyBC</em> instances.</li></ol> <p>Regardless which above option is chosen, you need to config <em>NotifyBC</em> inbound SMTP server by adding following static config <em>inboundSmtpServer</em> to file <em>/server/config.local.js</em></p> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
  inboundSmtpServer<span class="token operator">:</span> <span class="token punctuation">{</span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    domain<span class="token operator">:</span> <span class="token string">'host.foo.com'</span><span class="token punctuation">,</span>
    listeningSmtpPort<span class="token operator">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
    options<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token operator">...</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>where</p> <ul><li><em>enabled</em> enables/disables the inbound SMTP server with default to <em>true</em>.</li> <li><em>domain</em> is the internet-facing host domain. It has no default so <strong>must be set</strong>.</li> <li><em>listeningSmtpPort</em> should be set to 25 if option 1 above is chosen. For options 2, <em>listeningSmtpPort</em> can be set to any opening port. On Unix, <em>NotifyBC</em> has to be run under <em>root</em> account to bind to port 25. If missing, <em>NotifyBC</em> will randomly select an available port upon launch which is usually undesirable so it <strong>should be set</strong>.</li> <li>optional <em>options</em> object defines the behavior of <a href="https://nodemailer.com/extras/smtp-server/#step-3-create-smtpserver-instance" target="_blank" rel="noopener noreferrer">Nodemailer SMTP Server<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</li></ul> <div class="custom-block warning"><p class="custom-block-title">Inbound SMTP Server on OpenShift</p> <p>OpenShift deployment template deploys an inbound SMTP server. Due to the limitation that OpenShift can only expose port 80 and 443 to external, to use the SMTP server, you have to setup a TCP proxy server (i.e. option 2). The inbound SMTP server is exposed as ${INBOUND_SMTP_DOMAIN}:443 , where ${INBOUND_SMTP_DOMAIN} is a template parameter which in absence, a default domain will be created. Configure your TCP proxy server to route traffic to ${INBOUND_SMTP_DOMAIN}:443 over TLS.</p></div> <h2 id="tcp-proxy-server"><a href="#tcp-proxy-server" class="header-anchor">#</a> TCP Proxy Server</h2> <p>If <em>NotifyBC</em> is not able to bind to port 25 that opens to internet, perhaps
due to firewall restriction, you can setup a TCP Proxy Server such as Nginx with <a href="http://nginx.org/en/docs/stream/ngx_stream_proxy_module.html" target="_blank" rel="noopener noreferrer">ngx_stream_proxy_module<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. For example, the following nginx config will proxy SMTP traffic from port 25 to a <em>NotifyBC</em> inbound SMTP server running on OpenShift</p> <div class="language- extra-class"><pre class="language-text"><code>stream {
    server {
        listen 25;
        proxy_pass ${INBOUND_SMTP_DOMAIN}:443;
        proxy_ssl on;
        proxy_ssl_verify off;
        proxy_ssl_server_name on;
        proxy_connect_timeout 10s;
    }
}
</code></pre></div><p>Replace <em>${INBOUND_SMTP_DOMAIN}</em> with the inbound SMTP server route domain.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/NotifyBC/version/2-pre-alpha/docs/config-internalHttpHost/" class="prev">
        Internal HTTP Host
      </a></span> <span class="next"><a href="/NotifyBC/version/2-pre-alpha/docs/config-listUnsubscribeByEmail/">
        List-unsubscribe by Email
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/NotifyBC/version/2-pre-alpha/assets/js/app.aa1ca42f.js" defer></script><script src="/NotifyBC/version/2-pre-alpha/assets/js/4.ef7266ed.js" defer></script><script src="/NotifyBC/version/2-pre-alpha/assets/js/5.c02a3e01.js" defer></script><script src="/NotifyBC/version/2-pre-alpha/assets/js/21.c7ec8954.js" defer></script>
  </body>
</html>

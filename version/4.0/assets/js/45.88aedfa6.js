(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{444:function(t,a,e){"use strict";e.r(a);var s=e(42),n=Object(s.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"upgrade-guide"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-guide"}},[t._v("#")]),t._v(" Upgrade Guide")]),t._v(" "),e("h2",{attrs:{id:"v1-to-v2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#v1-to-v2"}},[t._v("#")]),t._v(" v1 to v2")]),t._v(" "),e("p",[t._v("Upgrading "),e("em",[t._v("NotifyBC")]),t._v(" from v1 to v2 involves two steps")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"#update-your-client-code"}},[t._v("Update your client code")]),t._v(" if needed")]),t._v(" "),e("li",[e("a",{attrs:{href:"#upgrade-notifybc-server"}},[t._v("Upgrade "),e("em",[t._v("NotifyBC")]),t._v(" server")])])]),t._v(" "),e("h3",{attrs:{id:"update-your-client-code"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#update-your-client-code"}},[t._v("#")]),t._v(" Update your client code")]),t._v(" "),e("p",[e("em",[t._v("NotifyBC")]),t._v(" v2 introduced backward incompatible API changes documented in the rest of this section. If your client code will be impacted by the changes, update your code to address the incompatibility first.")]),t._v(" "),e("h4",{attrs:{id:"query-parameter-array-syntax"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#query-parameter-array-syntax"}},[t._v("#")]),t._v(" Query parameter array syntax")]),t._v(" "),e("p",[t._v("In v1 array can be specified in query parameter using two formats")]),t._v(" "),e("ol",[e("li",[t._v("by enclosing array elements in square brackets such as "),e("code",[t._v('&additionalServices=["s1","s2]')]),t._v(" in one query parameter")]),t._v(" "),e("li",[t._v("by repeating the query parameters, for example "),e("code",[t._v("&additionalServices=s1&additionalServices=s2")])])]),t._v(" "),e("p",[t._v("In v2 only the latter format is supported.")]),t._v(" "),e("h4",{attrs:{id:"date-time-fields"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#date-time-fields"}},[t._v("#")]),t._v(" Date-Time fields")]),t._v(" "),e("p",[t._v("In v1 date-time fields can be specified in date-only string such as 2020-01-01. In v2 the field must be specified in ISO 8601 extended format such as 2020-01-01T00:00:00Z.")]),t._v(" "),e("h4",{attrs:{id:"return-status-codes"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#return-status-codes"}},[t._v("#")]),t._v(" Return status codes")]),t._v(" "),e("p",[t._v("HTTP response code of success calls to following APIs are changed from 200 to 204")]),t._v(" "),e("ul",[e("li",[t._v("most PATCH by id requests except for "),e("RouterLink",{attrs:{to:"/docs/api-subscription/#update-a-subscription"}},[t._v("Update a Subscription\n")])],1),t._v(" "),e("li",[t._v("most PUT by id requests except for "),e("RouterLink",{attrs:{to:"/docs/api-subscription/#replace-a-subscription"}},[t._v("Replace a Subscription")])],1),t._v(" "),e("li",[t._v("most DELETE by id requests except for "),e("RouterLink",{attrs:{to:"/docs/api-subscription/#delete-a-subscription-unsubscribing"}},[t._v("Delete a Subscription (unsubscribing)")])],1)]),t._v(" "),e("h4",{attrs:{id:"administrator-api"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#administrator-api"}},[t._v("#")]),t._v(" Administrator API")]),t._v(" "),e("ul",[e("li",[t._v("Password is saved to "),e("em",[t._v("Administrator")]),t._v(" in v1 and "),e("em",[t._v("UserCredential")]),t._v(" in v2. Password is not migrated. New password has to be created by following "),e("RouterLink",{attrs:{to:"/docs/api-administrator/#create-update-an-administrator-s-usercredential"}},[t._v("Create/Update an Administrator's UserCredential\n")]),t._v(".")],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/docs/api/administrator.html#sign-up"}},[t._v("Complexity rules")]),t._v(" have been applied to passwords.")],1),t._v(" "),e("li",[e("RouterLink",{attrs:{to:"/docs/api-administrator/#login"}},[t._v("login")]),t._v(" API is open to non-admin")],1)]),t._v(" "),e("h3",{attrs:{id:"upgrade-notifybc-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#upgrade-notifybc-server"}},[t._v("#")]),t._v(" Upgrade "),e("em",[t._v("NotifyBC")]),t._v(" server")]),t._v(" "),e("p",[t._v("The procedure to upgrade from v1 to v2 depends on how v1 was installed.")]),t._v(" "),e("h4",{attrs:{id:"source-code-installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#source-code-installation"}},[t._v("#")]),t._v(" Source-code Installation")]),t._v(" "),e("ol",[e("li",[t._v("Stop "),e("em",[t._v("NotifyBC")])]),t._v(" "),e("li",[t._v("Backup app root and database!")]),t._v(" "),e("li",[t._v("Make sure current branch is tracking correct remote branch"),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" remote set-url origin https://github.com/bcgov/NotifyBC.git\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" branch -u origin/main\n")])])])]),t._v(" "),e("li",[t._v("Make a note of any extra packages added to "),e("em",[t._v("package.json")])]),t._v(" "),e("li",[t._v("Run "),e("code",[t._v("git pull && git checkout tags/v2.x.x -b <branch_name>")]),t._v(" from app root, replace "),e("em",[t._v("v2.x.x")]),t._v(" with a v2 release, preferably latest, found in GitHub such as "),e("em",[t._v("v2.9.0")]),t._v(".")]),t._v(" "),e("li",[t._v("Make sure "),e("em",[t._v("version")]),t._v(" property in "),e("em",[t._v("package.json")]),t._v(" is "),e("em",[t._v("2.x.x")])]),t._v(" "),e("li",[t._v("Add back extra packages noted in step 4")]),t._v(" "),e("li",[t._v("Move "),e("em",[t._v("server/config.(local|dev|production).(js|json)")]),t._v(" to "),e("em",[t._v("src/")]),t._v(" if exists")]),t._v(" "),e("li",[t._v("Move "),e("em",[t._v("server/datasources.(local|dev|production).(js|json)")]),t._v(" to "),e("em",[t._v("src/datasources/db.datasource.(local|dev|production).(js|json)")]),t._v(" if exists. Notice the file name has changed.")]),t._v(" "),e("li",[t._v("Move "),e("em",[t._v("server/middleware.*.(js|json)")]),t._v(" to "),e("em",[t._v("src/")]),t._v(" if exists. Reorganize top level properties to "),e("em",[t._v("all")]),t._v(" or "),e("em",[t._v("apiOnly")]),t._v(", where "),e("em",[t._v("all")]),t._v(" applies to all requests including web console and "),e("em",[t._v("apiOnly")]),t._v(" applies to API requests only. For example, given")])]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  initial"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    compression"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'routes:before'")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    morgan"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      enabled"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[t._v("if "),e("em",[t._v("compression")]),t._v(" middleware will be applied to all requests and "),e("em",[t._v("morgan")]),t._v(" will be applied to API requests only, then change the file to")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  all"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    compression"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  apiOnly"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    morgan"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      enabled"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("ol",{attrs:{start:"11"}},[e("li",[t._v("Run")])]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build\n")])])]),e("ol",{attrs:{start:"11"}},[e("li",[t._v("Start server by running "),e("code",[t._v("yarn start")]),t._v(" or Windows Service")])]),t._v(" "),e("h4",{attrs:{id:"openshift-installation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openshift-installation"}},[t._v("#")]),t._v(" OpenShift Installation")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("Run")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" clone https://github.com/bcgov/NotifyBC.git\n"),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" NotifyBC\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Run")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("oc delete bc/notify-bc\noc process -f .openshift-templates/notify-bc-build.yml "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" oc create -f-\n")])])]),e("p",[t._v("ignore "),e("em",[t._v("AlreadyExists")]),t._v(" errors")])]),t._v(" "),e("li",[e("p",[t._v("Follow OpenShift "),e("RouterLink",{attrs:{to:"/docs/installation/#build"}},[t._v("Build")])],1)]),t._v(" "),e("li",[e("p",[t._v("For each environment,")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("run")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("oc project "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("yourprojectname-"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("env"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v("\noc delete dc/notify-bc-app dc/notify-bc-cron\noc process -f .openshift-templates/notify-bc.yml "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" oc create -f-\n")])])]),e("p",[t._v("ignore "),e("em",[t._v("AlreadyExists")]),t._v(" errors")])]),t._v(" "),e("li",[e("p",[t._v("copy value of environment variable "),e("em",[t._v("MONGODB_USER")]),t._v(" from "),e("em",[t._v("mongodb")]),t._v(" deployment config to the same environment variable of deployment config "),e("em",[t._v("notify-bc-app")]),t._v(" and "),e("em",[t._v("notify-bc-cron")]),t._v(", replacing existing value")])]),t._v(" "),e("li",[e("p",[t._v("remove "),e("em",[t._v("middleware.local.json")]),t._v(" from configMap "),e("em",[t._v("notify-bc")])])]),t._v(" "),e("li",[e("p",[t._v("add "),e("em",[t._v("middleware.local.js")]),t._v(" to configMap "),e("em",[t._v("notify-bc")]),t._v(" with following content")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("module"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  apiOnly"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    morgan"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      enabled"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])]),t._v(" "),e("li",[e("p",[t._v("Follow OpenShift "),e("RouterLink",{attrs:{to:"/docs/installation/#deploy"}},[t._v("Deploy")]),t._v(" or "),e("RouterLink",{attrs:{to:"/docs/installation/#change-propagation"}},[t._v("Change Propagation")]),t._v(" to tag image")],1)])])])]),t._v(" "),e("h2",{attrs:{id:"openshift-template-to-helm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#openshift-template-to-helm"}},[t._v("#")]),t._v(" OpenShift template to Helm")]),t._v(" "),e("p",[t._v("Upgrading "),e("em",[t._v("NotifyBC")]),t._v(" on OpenShift created from OpenShift template to Helm involves 2 steps")]),t._v(" "),e("ol",[e("li",[e("a",{attrs:{href:"#customize-and-install-helm-chart"}},[t._v("Customize and Install Helm chart")])]),t._v(" "),e("li",[e("a",{attrs:{href:"#migrate-mongodb-data"}},[t._v("Migrate MongoDB data")])])]),t._v(" "),e("h3",{attrs:{id:"customize-and-install-helm-chart"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#customize-and-install-helm-chart"}},[t._v("#")]),t._v(" Customize and install Helm chart")]),t._v(" "),e("p",[t._v("Follow "),e("RouterLink",{attrs:{to:"/docs/installation/#customizations"}},[t._v("customizations")]),t._v(" to create file "),e("em",[t._v("helm/values.local.yaml")]),t._v(" containing customized configs such as")],1),t._v(" "),e("ul",[e("li",[e("em",[t._v("notify-bc")]),t._v(" configMap")]),t._v(" "),e("li",[t._v("web route host name and certificates")])]),t._v(" "),e("p",[t._v("Then run "),e("code",[t._v("helm install")]),t._v(" with documented arguments to install a release.")]),t._v(" "),e("h3",{attrs:{id:"migrate-mongodb-data"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#migrate-mongodb-data"}},[t._v("#")]),t._v(" Migrate MongoDB data")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("backup data from source")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("oc "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mongodb-pod"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongodump -u \""),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_USER")]),t._v('" \\\n-p "'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_PASSWORD")]),t._v('" -d '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_DATABASE")]),t._v(" --gzip --archive'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" notify-bc.gz\n")])])]),e("p",[t._v("replace <mongodb-pod> with the mongodb pod name.")])]),t._v(" "),e("li",[e("p",[t._v("restore backup to target")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("cat")]),t._v(" notify-bc.gz "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" oc "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mongodb-pod-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" -- "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongorestore -u \""),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_USERNAME")]),t._v('" -p"'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_PASSWORD")]),t._v('" \\\n--uri="mongodb://'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$K8S_SERVICE_NAME")]),t._v('" --db '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_DATABASE")]),t._v(" --gzip --drop --archive'")]),t._v("\n")])])]),e("p",[t._v("replace <mongodb-pod-0> with the first pod name in the mongodb stateful set.")])])]),t._v(" "),e("p",[t._v("If both source and target are in the same OpenShift cluster, the two operations can be\ncombined into one")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[t._v("oc "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mongodb-pod"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongodump -u \""),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_USER")]),t._v('" \\\n-p "'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_PASSWORD")]),t._v('" -d '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_DATABASE")]),t._v(" --gzip --archive'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\noc "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("exec")]),t._v(" -i "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("mongodb-pod-"),e("span",{pre:!0,attrs:{class:"token operator"}},[e("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" -- "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("bash")]),t._v(" -c "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mongorestore -u \""),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_USERNAME")]),t._v('" -p"'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_PASSWORD")]),t._v('" \\\n--uri="mongodb://'),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$K8S_SERVICE_NAME")]),t._v('" --db '),e("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$MONGODB_DATABASE")]),t._v(" --gzip --drop --archive'")]),t._v("\n")])])]),e("h2",{attrs:{id:"v2-to-v3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#v2-to-v3"}},[t._v("#")]),t._v(" v2 to v3")]),t._v(" "),e("p",[t._v("v3 introduced following backward incompatible changes")]),t._v(" "),e("ol",[e("li",[t._v("Changed output-only fields "),e("em",[t._v("failedDispatches")]),t._v(" and "),e("em",[t._v("successDispatches")]),t._v(" to "),e("em",[t._v("dispatch.failed")]),t._v(" and "),e("em",[t._v("dispatch.successful")]),t._v(" respectively in "),e("em",[t._v("Notification")]),t._v(" api. If your client app depends on the fields, change accordingly.")]),t._v(" "),e("li",[t._v("Changed config "),e("em",[t._v("notification.logSuccessfulBroadcastDispatches")]),t._v(" to "),e("em",[t._v("notification.guaranteedBroadcastPushDispatchProcessing")]),t._v(" and reversed default value from "),e("em",[t._v("false")]),t._v(" to "),e("em",[t._v("true")]),t._v(". If you don't want "),e("em",[t._v("NotifyBC")]),t._v(" guarantees processing all subscriptions to a broadcast push notification in a node failure resilient way, perhaps for performance reason, set the value to "),e("em",[t._v("false")]),t._v(" in file "),e("em",[t._v("/src/config.local.js")]),t._v(".")])]),t._v(" "),e("p",[t._v("After above changes are addressed, upgrading to v3 is as simple as")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout tags/v3.x.x -b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("branch_name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build\n")])])]),e("p",[t._v("or, if "),e("em",[t._v("NotifyBC")]),t._v(" is deployed to Kubernetes using Helm.")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout tags/v3.x.x -b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("branch_name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("release-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -f helm/platform-specific/"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("platform"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".yaml -f helm/values.local.yaml helm\n")])])]),e("p",[t._v("Replace "),e("em",[t._v("v3.x.x")]),t._v(" with a v4 release, preferably latest, found in GitHub such as "),e("em",[t._v("v3.1.2")]),t._v(".")]),t._v(" "),e("h2",{attrs:{id:"v3-to-v4"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#v3-to-v4"}},[t._v("#")]),t._v(" v3 to v4")]),t._v(" "),e("p",[t._v("v4 introduced following backward incompatible changes that need to be addressed in this order")]),t._v(" "),e("ol",[e("li",[e("p",[t._v("The precedence of config, middleware and datasource files has been changed. Local file takes higher precedence than environment specific file. For example, for config file, the new precedence in ascending order is")]),t._v(" "),e("ol",[e("li",[t._v("default file "),e("em",[t._v("/src/config.ts")])]),t._v(" "),e("li",[t._v("environment specific file "),e("em",[t._v("/src/config.<env>.js")]),t._v(", where <env> is determined by environment variable "),e("em",[t._v("NODE_ENV")])]),t._v(" "),e("li",[t._v("local file "),e("em",[t._v("/src/config.local.js")])])]),t._v(" "),e("p",[t._v("To upgrade, if you have environment specific file, merge its content into the local file, then delete it.")])]),t._v(" "),e("li",[e("p",[t._v("Config "),e("em",[t._v("smtp")]),t._v(" is changed to "),e("em",[t._v("email.smtp")]),t._v(". See "),e("RouterLink",{attrs:{to:"/docs/config/email.html#smtp"}},[t._v("SMTP")]),t._v(" for example.")],1)]),t._v(" "),e("li",[e("p",[t._v("Config "),e("em",[t._v("inboundSmtpServer")]),t._v(" is changed to "),e("em",[t._v("email.inboundSmtpServer")]),t._v(". See "),e("RouterLink",{attrs:{to:"/docs/config/email.html#inbound-smtp-server"}},[t._v("Inbound SMTP Server")]),t._v(" for example.")],1)]),t._v(" "),e("li",[e("p",[t._v("Config "),e("em",[t._v("email.inboundSmtpServer.bounce")]),t._v(" is changed to "),e("em",[t._v("email.bounce")]),t._v(". See "),e("RouterLink",{attrs:{to:"/docs/config/email.html#bounce"}},[t._v("Bounce")]),t._v(" for example.")],1)]),t._v(" "),e("li",[e("p",[t._v("Config "),e("em",[t._v("notification.handleBounce")]),t._v(" is changed to "),e("em",[t._v("email.bounce.enabled")]),t._v(".")])]),t._v(" "),e("li",[e("p",[t._v("Config "),e("em",[t._v("notification.handleListUnsubscribeByEmail")]),t._v(" is changed to "),e("em",[t._v("email.listUnsubscribeByEmail.enabled")]),t._v(". See "),e("RouterLink",{attrs:{to:"/docs/config/email.html#list-unsubscribe-by-email"}},[t._v("List-unsubscribe by Email")]),t._v(" for example.")],1)]),t._v(" "),e("li",[e("p",[t._v("Config "),e("em",[t._v("smsServiceProvider")]),t._v(" is changed to "),e("em",[t._v("sms.provider")]),t._v(". See "),e("RouterLink",{attrs:{to:"/docs/config/sms.html#provider"}},[t._v("Provider")]),t._v(" for example.")],1)]),t._v(" "),e("li",[e("p",[t._v("SMS service provider specific settings defined in config "),e("em",[t._v("sms")]),t._v(" are changed to "),e("em",[t._v("sms.providerSettings")]),t._v(". See "),e("RouterLink",{attrs:{to:"/docs/config/sms.html#provider-settings"}},[t._v("Provider Settings")]),t._v(" for example. The config object "),e("em",[t._v("sms")]),t._v(" now encapsulates all SMS configs - "),e("em",[t._v("provider")]),t._v(", "),e("em",[t._v("providerSettings")]),t._v(" and "),e("em",[t._v("throttle")]),t._v(".")],1)]),t._v(" "),e("li",[e("p",[t._v("Legacy config "),e("em",[t._v("subscription.unsubscriptionEmailDomain")]),t._v(" is removed. If you have it defined in your file "),e("em",[t._v("/src/config.local.js")]),t._v(", replace with "),e("em",[t._v("email.inboundSmtpServer.domain")]),t._v(".")])]),t._v(" "),e("li",[e("p",[t._v("Helm chart added Redis that requires authentication by default. Create a new password in "),e("em",[t._v("helm/values.local.yaml")]),t._v(" to facilitate upgrading")])])]),t._v(" "),e("div",{staticClass:"language-yaml extra-class"},[e("pre",{pre:!0,attrs:{class:"language-yaml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# in file helm/values.local.yaml")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("auth")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("password")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'<secret>'")]),t._v("\n")])])]),e("p",[t._v("After above changes are addressed, upgrading to v4 is as simple as")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout tags/v4.x.x -b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("branch_name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" build\n")])])]),e("p",[t._v("or, if "),e("em",[t._v("NotifyBC")]),t._v(" is deployed to Kubernetes using Helm.")]),t._v(" "),e("div",{staticClass:"language-sh extra-class"},[e("pre",{pre:!0,attrs:{class:"language-sh"}},[e("code",[e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" pull\n"),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("git")]),t._v(" checkout tags/v4.x.x -b "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("branch_name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nhelm upgrade "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("release-name"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" -f helm/platform-specific/"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("platform"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(".yaml -f helm/values.local.yaml helm\n")])])]),e("p",[t._v("Replace "),e("em",[t._v("v4.x.x")]),t._v(" with a v4 release, preferably latest, found in GitHub such as "),e("em",[t._v("v4.0.0")]),t._v(".")])])}),[],!1,null,null,null);a.default=n.exports}}]);